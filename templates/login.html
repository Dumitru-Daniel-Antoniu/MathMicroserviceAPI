<!-- templates/login.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Login / Register</title>
    <style>
        .hidden { display: none; }
        .toggle-link { color: blue; cursor: pointer; text-decoration: underline; }
    </style>
    <script>
        function showForm(form) {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById(form + '-form').classList.remove('hidden');
        }

        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;
            const response = await fetch("/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password }),
                credentials: "include"
            });
            if (response.ok) {
                const data = await response.json();
                document.cookie = `access_token=${data.access_token}; path=/; SameSite=Lax`;
                window.location.href = "/";
            } else {
                alert("Invalid username or password");
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const username = document.getElementById("register-username").value;
            const password = document.getElementById("register-password").value;
            const response = await fetch("/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password }),
                credentials: "include"
            });
            if (response.ok) {
                const data = await response.json();
                document.cookie = `access_token=${data.access_token}; path=/; SameSite=Lax`;
                window.location.href = "/";
            } else {
                alert("Registration failed");
            }
        }
    </script>
</head>
<body>
    <div id="login-form">
        <h2>Login</h2>
        <form onsubmit="handleLogin(event)">
            <label for="login-username">Username:</label>
            <input id="login-username" name="username" type="text" required>
            <br>
            <label for="login-password">Password:</label>
            <input id="login-password" name="password" type="password" required>
            <br>
            <button type="submit">Login</button>
        </form>
        <p>Don't have an account? <span class="toggle-link" onclick="showForm('register')">Register here</span></p>
    </div>
    <div id="register-form" class="hidden">
        <h2>Register</h2>
        <form onsubmit="handleRegister(event)">
            <label for="register-username">Username:</label>
            <input id="register-username" name="username" type="text" required>
            <br>
            <label for="register-password">Password:</label>
            <input id="register-password" name="password" type="password" required>
            <br>
            <button type="submit">Register</button>
        </form>
        <p>Already have an account? <span class="toggle-link" onclick="showForm('login')">Log in here</span></p>
    </div>
    <script>
        // Show login form by default
        showForm('login');
    </script>
</body>
</html>